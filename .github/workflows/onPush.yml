name: Java CI

on: [push]

jobs:
  test:
    env:
      spring.datasource.url:jdbc:postgresql://localhost:5432/${{secrets.POSTGRES_DB}}
      spring.datasource.username:${{secrets.POSTGRES_USER}}
      spring.datasource.password:${{secrets.POSTGRES_PASSWORD}}
      spring.jpa.database-platform:org.hibernate.dialect.H2Dialect
      figures.dir:/
      export.dir:/
      load.dir:/
      oauth.consumer.key:2
      oauth.consumer.secret:r
      callback.url:http://localhost:8081/login
      base.url:https://fenix.tecnico.ulisboa.pt
    runs-on: ubuntu-latest

    steps:
#     - uses: actions/checkout@v1
#     - name: Setup PostgreSQL
#       uses: Harmon758/postgresql-action@v1.0.0
#       env:
#         POSTGRES_DB:${{secrets.POSTGRES_DB}}
#         POSTGRES_USER:${{secrets.POSTGRES_USER}}
#         POSTGRES_PASSWORD:${{secrets.POSTGRES_PASSWORD}}
#       with:
#         postgresql db:${{secrets.POSTGRES_DB}}
#         postgresql user:${{secrets.POSTGRES_USER}}
#         postgresql password:${{secrets.POSTGRES_PASSWORD}}
        
    - name: Set up JDK 11
      uses: actions/setup-java@v1
      with:
        java-version: 1.11
    - name: Build with Maven
      run: mvn clean --file spring-api/pom.xml test
